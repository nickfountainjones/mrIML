<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Swine biosecurity • mrIML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Swine biosecurity">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mrIML</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mrIML.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Landscape%20genetics%20(classification).html">Landscape genetics (classification)</a></li>
    <li><a class="dropdown-item" href="../articles/Regression.html">Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Graphical%20network%20model%20(GNM).html">Graphical network model (GNM)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/Common%20errors%20in%20mrIML.html">Common errors in mrIML</a></li>
    <li><a class="dropdown-item" href="../articles/Microbiome%20data%20curation.html">Microbiome data curation</a></li>
    <li><a class="dropdown-item" href="../articles/Swine%20biosecurity.html">Swine biosecurity</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/nickfountainjones/mrIML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Swine biosecurity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nickfountainjones/mrIML/blob/master/vignettes/articles/Swine%20biosecurity.Rmd"><code>vignettes/articles/Swine biosecurity.Rmd</code></a></small>
      <div class="d-none name"><code>Swine biosecurity.Rmd</code></div>
    </div>

    
    
<p>MrIML is a R package allows users to generate and interpret
multi-response models (i.e., joint species distribution models)
leveraging advances in data science and machine learning. MrIML couples
the tidymodel infrastructure developed by Max Kuhn and colleagues with
model agnostic interpretable machine learning tools to gain insights
into multiple response data such as. As such MrIML is flexible and
easily extendable allowing users to construct everything from simple
linear models to tree-based methods for each response using the same
syntax and same way to compare predictive performance.In this vignette
we will guide you through how to apply the MrIML framework to identify
and benchmark biosecurity practices in veterinary disease.</p>
<p>This working example is built upon a classification framework. More
information about this can be found in the “Classification working
example”. In this case we are predicting one response.</p>
<div class="section level3">
<h3 id="lets-load-that-data">Lets load that data<a class="anchor" aria-label="anchor" href="#lets-load-that-data"></a>
</h3>
<p>This is a synthesized dataset to simulate PRRSV infection,
biosecurity practices and farm demographics on swine farms across the
united states. Please note that the data included in this package is
simulated, and is not a reflection of any real farm, company or
state.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span> <span class="co">#set the seed to ensure consistency</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"biosecurity_data.RData"</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">biosecurity_vignette_data</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-your-model-engine">Defining your model engine<a class="anchor" aria-label="anchor" href="#defining-your-model-engine"></a>
</h3>
<p>This is a random forest model, as used in the classification example.
However there are more models available within MrIML and can be found <a href="https://www.tidymodels.org/find/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#split predictor variables and outcome</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">44</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>              mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>              min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>              mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"randomForest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p>MrIML provides uses the flexible future apply functionality to set up
multi-core processing. In the example below, we set up a cluster using 4
cores. If you don’t set up a cluster, the default settings will be used
and the analysis will run sequentially.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-analysis">Running the analysis<a class="anchor" aria-label="anchor" href="#running-the-analysis"></a>
</h3>
<p>Now we can train and test our model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X</span>, <span class="co">#features/predictors </span></span>
<span>                       Y<span class="op">=</span><span class="va">Y</span>, <span class="co">#response data</span></span>
<span>                       Model<span class="op">=</span><span class="va">model1</span>, <span class="co">#specify your model</span></span>
<span>                       racing<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="co">#turn off racing autotuning for now</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
<p>We can then assess our model performance using a number of
performance metrics including area under the curve (AUC), sensitivity,
specificity and Matthews correlation coefficient (MCC).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ModelPerf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ModelPerf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#predictive performance for individual responses </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">#&gt;   response model_name  roc_AUC    mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Class    rand_forest   0.573 0.029<span style="text-decoration: underline;">2</span>       0.581 0.529       0.448        0.5</span></span>
<span><span class="va">ModelPerf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="co">#overall predictive performance. r2 for regression and MCC for classification</span></span>
<span><span class="co">#&gt; [1] 0.02916536</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking-global-importance">Benchmarking: global importance<a class="anchor" aria-label="anchor" href="#benchmarking-global-importance"></a>
</h3>
<p>Here we can look at the variable importance. This is the dependence
between our outcome and biosecurity variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#calculate variable importance</span></span>
<span><span class="co">#still got a bug here to do with the PCA</span></span>
<span><span class="va">impVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrVip.html">mrVip</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  global_top_var <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  local_top_var <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  taxa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model_perf <span class="op">=</span> <span class="va">ModelPerf</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">impVI</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="co">#importance</span></span></code></pre></div>
<p>We can explore further and assess the partial dependence of each
variable. Here we isolate the dependence of one variable and visualize
how this dependence changes over different observed values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create a flashlight object</span></span>
<span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrFlashlight.html">mrFlashlight</a></span><span class="op">(</span><span class="va">yhats</span>,</span>
<span>                   response<span class="op">=</span><span class="st">"single"</span>, </span>
<span>                   index<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#plot partial dependence profiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/flashlight/man/light_profile.html" class="external-link">light_profile</a></span><span class="op">(</span><span class="va">fl</span>, v <span class="op">=</span> <span class="st">"Premises_in_3_miles"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../../../../../../tmp/RtmpxBOuBs/articles/reference/figures/pdp-1.png" width="768" style="display: block; margin: auto;">
### Benchmarking: predicted risk</p>
<p>The following function allows you to visualize and compare predicted
risk among and within groups</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#apply the trained model to the entire data set to provide risk of predicted outbreak</span></span>
<span><span class="va">fit_bio</span> <span class="op">&lt;-</span> <span class="fu">extract_workflow</span><span class="op">(</span><span class="va">yhats</span><span class="op">$</span><span class="va">Fits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">last_mod_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_bio</span> <span class="op">&lt;-</span> <span class="va">fit_bio</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>    new_data <span class="op">=</span> <span class="va">yhats</span><span class="op">$</span><span class="va">Fits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"prob"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#...</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot within group comparison of predicted risk</span></span>
<span><span class="fu">mrBenchmark</span><span class="op">(</span>data <span class="op">=</span> <span class="st">"data1"</span>,</span>
<span>            Y <span class="op">=</span> <span class="st">"Class"</span>,</span>
<span>            pred <span class="op">=</span> <span class="st">"Predicted"</span>,</span>
<span>            group <span class="op">=</span> <span class="st">"Group"</span>,</span>
<span>            label_by <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"internal"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking-local-importance">Benchmarking: local importance<a class="anchor" aria-label="anchor" href="#benchmarking-local-importance"></a>
</h3>
<p>To investigate and interpret the contribution of variables at an
individual level, we must use a local explanation method. Here we
implement a local breakDown explainer. <code>mrLocalExplainer</code>
produces both aggregated and individual results of variable
contribution. Variables with a phi &gt; 0 contribute to an increase in
predicted PRRSV outbreak risk, while variables with a phi &lt; 0
contribute to a decrease in predicted outbreak risk.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Use this function to implement the local explainer </span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="fu">revalue</span><span class="op">(</span><span class="va">Class</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Positive"</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Negative"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Class</span>, <span class="st">"Positive"</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="va">X</span></span>
<span><span class="fu">mrLocalExplainer</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>,</span>
<span>                 Model <span class="op">=</span> <span class="va">yhats</span>,</span>
<span>                 Y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span></code></pre></div>
<p>Individual plots are produced in the list object
<code>LE_indiv_plots</code>. Each plot corresponds to a single farm. An
example of a positive farm and a negative farm are shown here.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LE_indiv_plots</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">LE_indiv_plots</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>At the positive farm we can see that yards from the public road and
garbage collection are contributing to an increased outbreak risk, while
manure removals and repair visits are contributing to a decreased
outbreak risk. Likewise, at the negative farm yards to the public road
and and the downtime required for manure removal personnel are
contributing to an increased outbreak risk, while feed deliveries and
manure removals are contributing to a decreased outbreak risk.</p>
<p>This session of the MrIML has been funded by Critical Agricultural
Research and Extension 2019-68008-29910 from the USDA National Institute
of Food and Agriculture.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://discover.utas.edu.au/Nick.FountainJones" class="external-link">Nick Fountain-Jones</a>, Ryan Leadbetter, <a href="https://machado-lab.github.io/" class="external-link">Gustavo Machado</a>, Chris Kozakiewicz, Nick Clark.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
