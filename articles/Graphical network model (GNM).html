<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Graphical network model (GNM) • mrIML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Graphical network model (GNM)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mrIML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/mrIML.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Multi-response%20(classification).html">Multi-response (classification)</a></li>
    <li><a class="dropdown-item" href="../articles/Multi-response%20(regression).html">Multi-response (regression)</a></li>
    <li><a class="dropdown-item" href="../articles/Graphical%20network%20model%20(GNM).html">Graphical network model (GNM)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/Common%20errors%20in%20mrIML.html">Common errors in mrIML</a></li>
    <li><a class="dropdown-item" href="../articles/Microbiome%20data%20curation.html">Microbiome data curation</a></li>
    <li><a class="dropdown-item" href="../articles/Swine%20biosecurity.html">Swine biosecurity</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/nickfountainjones/mrIML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Graphical network model (GNM)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nickfountainjones/mrIML/blob/master/vignettes/articles/Graphical%20network%20model%20(GNM).Rmd"><code>vignettes/articles/Graphical network model (GNM).Rmd</code></a></small>
      <div class="d-none name"><code>Graphical network model (GNM).Rmd</code></div>
    </div>

    
    
<p>This vignette guides you through the new functionality that turns a
<code>mrIML</code> multi-response model into a graphical network model
(GNM). There are also new functions in <code>mrIML (&gt;= 2.0.0)</code>
that can be used in non-GNM models, such as for single-taxon SDMs, epi
models, gene-environment association (GEA) studies, and landscape
genetics. Advances in <a href="https://www.tidymodels.org" class="external-link">Tidymodels</a> are at the core of
these functions, as are exciting developments in interpretable machine
learning (e.g., for quickly quantifying interactions through
H-statistics). The capability to capture uncertainty via bootstraps and
<span style="color:red">spatial patterns</span> are also features of
this <code>mrIML</code> module. The examples come from the microbiome
world but are, of course, generalizable to any multi-response
problem.</p>
<p>Currently, the models are optimized and tested on presence/absence
data. Models suitable for abundance data will be added in the
future.</p>
<p>To demonstrate, first, we need to load some packages and data. The
first example uses coinfection data from New Caledonian
<em>Zosterops</em> species. A single continuous covariate is also
included (<code>scale.prop.zos</code>), which reflects the relative
abundance of <em>Zosterops</em> species among different sample
sites.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nickfountainjones/mrIML">mrIML</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/flashlight" class="external-link">flashlight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/briatte/ggnetwork" class="external-link">ggnetwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statnet.org/" class="external-link">network</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7007</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">MRFcov</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MRFcov/man/Bird.parasites.html" class="external-link">Bird.parasites</a></span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span>  <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">scale.prop.zos</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">scale.prop.zos</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="va">Y</span></span></code></pre></div>
<p>Note that the inclusion of <code>X1</code> converts
<code>mrIML</code> into a Joint Species Distribution Model (JSDM) by
directly adding the presence/absence patterns of the other taxa into the
model as predictors (along with other environmental/host covariates).
Note that the order of <code>X1</code> and <code>Y</code> needs to
match.</p>
<div class="section level2">
<h2 id="setting-up-the-models">Setting up the models<a class="anchor" aria-label="anchor" href="#setting-up-the-models"></a>
</h2>
<p>Built into the <code>mrIML</code> architecture (and a big advantage
of <code>tidymodels</code>) is the capability to change the underlying
model easily. We are going to set up two models to compare: a random
forest model (RF) and logistic regression (LM). <code>mrIML</code> takes
advantage of multi-core processing, so we set it up here to run on 5
cores. These steps are the same as in
<code>mrIML (&lt; 2.0.0)</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_rf</span> <span class="op">&lt;-</span><span class="fu">rand_forest</span><span class="op">(</span></span>
<span>  trees <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"classification"</span>,</span>
<span>  mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"randomForest"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_lm</span> <span class="op">&lt;-</span> <span class="fu">logistic_reg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-models">Running the models<a class="anchor" aria-label="anchor" href="#running-the-models"></a>
</h2>
<p>Aside from adding JSDM functionality with the <code>X1</code> call,
we have also enabled <code>mrIML</code> to tune hyperparameters using
the very efficient <code>racing</code> option (see Kuhn (2014)). In
brief, this racing option takes a small subsample of parameters and
eliminates combinations that do not improve fit using a
repeated-measures ANOVA model with <a href="https://finetune.tidymodels.org/reference/tune_race_anova.html" class="external-link"><code>finetune::tune_race_anova()</code></a>.
Setting <code>racing = FALSE</code> reverts to a grid search if you want
to manually set the tuning grid size (i.e., using <a href="https://tune.tidymodels.org/reference/tune_grid.html" class="external-link"><code>tune::tune_grid()</code></a>).
For logistic regression, there are no parameters to tune, so set
<code>racing = FALSE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#random forest</span></span>
<span><span class="va">yhats_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X1 <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  Model <span class="op">=</span> <span class="va">model_rf</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  racing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="co">#linear model</span></span>
<span><span class="va">yhats_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X1 <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  Model <span class="op">=</span> <span class="va">model_lm</span> , </span>
<span>  balance_data <span class="op">=</span> <span class="st">"no"</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  racing <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-performance">Comparing performance<a class="anchor" aria-label="anchor" href="#comparing-performance"></a>
</h2>
<p>It’s important to compare whether there are any advantages to using a
random forest approach. Interpretation would be easier overall if
logistic regression gave similar predictive performance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ModelPerf_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_rf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ModelPerf_rf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#across all parasites</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;   response     model_name roc_AUC   mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzosteropis  rand_fore…   0.951 0.714       0.941 0.923       0.758     0.265 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillangoi   rand_fore…   0.790 0.218       0.918 0.926       0.308     0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas         rand_fore…   0.902 0.438       0.955 0.875       0.4       0.196 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfilaria rand_fore…   0.905 0           1     0.896       0         0.098<span style="text-decoration: underline;">0</span></span></span>
<span><span class="va">ModelPerf_rf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co">#overall</span></span>
<span><span class="co">#&gt; [1] 0.3426539</span></span>
<span></span>
<span><span class="va">ModelPerf_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_lm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ModelPerf_lm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;   response    model_name roc_AUC    mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzosteropis logistic_…   0.810 0.335        0.922 0.776      0.346      0.265 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillangoi  logistic_…   0.657 0.052<span style="text-decoration: underline;">0</span>       0.975 0.897      0.052<span style="text-decoration: underline;">6</span>     0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas        logistic_…   0.774 0.119        0.972 0.815      0.085<span style="text-decoration: underline;">7</span>     0.196 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfilar… logistic_…   0.878 0.362        0.975 0.930      0.294      0.098<span style="text-decoration: underline;">0</span></span></span>
<span><span class="va">ModelPerf_lm</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.2169666</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrPerformancePlot.html">mrPerformancePlot</a></span><span class="op">(</span></span>
<span>  ModelPerf1 <span class="op">=</span> <span class="va">ModelPerf_lm</span>,</span>
<span>  ModelPerf2 <span class="op">=</span> <span class="va">ModelPerf_rf</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"classification"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span></span>
<span><span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/perf-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   response  metric_metric_logist…¹ metric_metric_rand_f…² outlier_outlier_logi…³</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzostero…                 0.335                   0.714 <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillang…                 0.052<span style="text-decoration: underline;">0</span>                  0.218 <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas                      0.119                   0.438 <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfil…                 0.362                   0     <span style="color: #BB0000;">NA</span>                    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​metric_metric_logistic_reg, ²​metric_metric_rand_forest,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​outlier_outlier_logistic_reg</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: outlier_outlier_rand_forest &lt;lgl&gt;, diff_mod1_2 &lt;dbl&gt;</span></span></span></code></pre></div>
<p>If we just look at the overall AUC values, model performance appears
quite similar (0.89 for the RF and 0.78 for the LM). However, when we
look at the Matthews correlation coefficient (MCC) for each taxon in the
LM model, we see that for <em>H.killangoi</em> and Plas
(<em>Plasmodium</em>), the values are much lower (an overall MCC of 0.22
for LM is basically just a guess, compared to 0.34 for the RF).
Remember, the classes are imbalanced, so AUC tends to be an inflated
measure. This provides evidence that non-linear relationships can
improve predictive performance.</p>
<p>Next, we ask whether including putative associations between taxa
improves model performance, or whether the relationship between
parasites and host relative abundance alone is sufficient (i.e.,
assuming independence between the parasites).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhats_rf_noAssoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  Model <span class="op">=</span> <span class="va">model_rf</span>,</span>
<span>  prop <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  racing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="va">ModelPerf_rf_noAssoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_rf_noAssoc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ModelPerf_rf_noAssoc</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;   response     model_name roc_AUC   mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzosteropis  rand_fore…   0.869 0.544       0.891 0.882       0.647     0.265 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillangoi   rand_fore…   0.678 0           1     0.948       0         0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas         rand_fore…   0.746 0.475       0.889 0.897       0.593     0.196 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfilaria rand_fore…   0.801 0.459       1     0.947       0.222     0.098<span style="text-decoration: underline;">0</span></span></span>
<span><span class="va">ModelPerf_rf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#performance including associations</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;   response     model_name roc_AUC   mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzosteropis  rand_fore…   0.951 0.714       0.941 0.923       0.758     0.265 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillangoi   rand_fore…   0.790 0.218       0.918 0.926       0.308     0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas         rand_fore…   0.902 0.438       0.955 0.875       0.4       0.196 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfilaria rand_fore…   0.905 0           1     0.896       0         0.098<span style="text-decoration: underline;">0</span></span></span></code></pre></div>
<p>You can see that overall, including associations improves model
performance, particularly for predicting <em>H.killangoi</em> and
<em>Microfilaria</em>. Using MCC to compare models is problematic
because, in the association-free model, it’s undefined for these taxa
(<code>NA</code> values arise because there are no false negatives for
low-prevalence taxa). <span style="color:red">Positive predictive value
(PPV) is useful in this case and shows that without associations, we
can’t predict the occurrence of these taxa (PPV = 0 for both). Including
associations increases PPV to ~0.2—not great, as 80% of our positive
predictions for these taxa are false.</span></p>
</div>
<div class="section level2">
<h2 id="downsampling">Downsampling<a class="anchor" aria-label="anchor" href="#downsampling"></a>
</h2>
<p>Including associations makes a difference, but how can we improve
predictions for our two rarer taxa? Upsampling is possible, but in this
case, we’ll try downsampling to see if correcting class imbalance
improves model fit.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yhats_rf_downSamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">X</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  X1 <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  Model <span class="op">=</span> <span class="va">model_rf</span>,</span>
<span>  balance_data <span class="op">=</span> <span class="st">"down"</span>, <span class="co">#down sampling</span></span>
<span>  prop <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  racing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==================                                                    |  25%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================================                  |  75%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="va">ModelPerf_rf_downSamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span><span class="va">yhats_rf_downSamp</span><span class="op">)</span></span>
<span><span class="va">ModelPerf_rf_downSamp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;   response     model_name roc_AUC   mcc sensitivity   ppv specificity prevalence</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Hzosteropis  rand_fore…   0.903 0.600       0.802 0.929       0.844     0.265 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Hkillangoi   rand_fore…   0.901 0.430       0.740 1           1         0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Plas         rand_fore…   0.863 0.525       0.739 0.956       0.88      0.196 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Microfilaria rand_fore…   0.942 0.448       0.760 1           1         0.098<span style="text-decoration: underline;">0</span></span></span></code></pre></div>
<p>Look at those PPV values now—much better. <span style="color:red">Our
false positive rate is down to &lt;6% overall. Now that we are happy
with the performance of the model, we can interrogate it
further.</span></p>
</div>
<div class="section level2">
<h2 id="interpreting-the-model">Interpreting the model<a class="anchor" aria-label="anchor" href="#interpreting-the-model"></a>
</h2>
<p>In many cases, like this dataset, community or microbiome data tend
to be small in size. Applying stochastic machine learning algorithms to
such data can lead to challenges. For instance, variable importance may
vary substantially when we build multiple models using the same data and
algorithm. To handle this variability and better understand prediction
uncertainty, <code>mrIML</code> now includes functionality to capture
uncertainty in the tuned model using bootstrapping. <span style="color:red">Additionally, this approach helps estimate how
variables affect the response, and these estimates align with those from
traditional linear regression models (see Cook et al., 2021).</span></p>
<p><code>mrIML</code> makes it easy to obtain bootstrap estimates for a
variety of interpretable machine learning tools and uses these estimates
to construct marginalized co-occurrence networks. First, let’s perform
bootstrapping and calculate variable importance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bs_malaria</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrBootstrap.html">mrBootstrap</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats_rf</span>,</span>
<span>  num_bootstrap <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  downsample <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="va">bs_impVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrVip.html">mrVip</a></span><span class="op">(</span></span>
<span>  mrIMLobj <span class="op">=</span> <span class="va">yhats_rf</span>,</span>
<span>  mrBootstrap_obj <span class="op">=</span> <span class="va">bs_malaria</span>,</span>
<span>  model_perf <span class="op">=</span> <span class="va">ModelPerf_rf</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bs_impVI</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/bootstraps-1.png" width="768" style="display: block; margin: auto;"></p>
<p>You can see that host abundance is the most important predictor of
this parasite community (followed by <em>H.zosteropsis</em>). However,
the sub-figure on the right shows substantial variability. For example,
<em>H.zosteropsis</em> is the most important predictor for the
occurrence of <em>Microfilaria</em>, and host abundance (shortened to
“sc..”) is less important.</p>
</div>
<div class="section level2">
<h2 id="bootstrap-partial-dependence-plots">Bootstrap partial dependence plots<a class="anchor" aria-label="anchor" href="#bootstrap-partial-dependence-plots"></a>
</h2>
<p>To examine the relationship between each variable and community
structure, <code>mrIML</code> has a convenient wrapper to plot
bootstrapped partial dependencies for a taxon of interest.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrPdPlotBootstrap.html">mrPdPlotBootstrap</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats_rf</span>,</span>
<span>  mrBootstrap_obj<span class="op">=</span><span class="va">bs_malaria</span>,</span>
<span>  vi_obj<span class="op">=</span><span class="va">bs_impVI</span>,</span>
<span>  target<span class="op">=</span><span class="st">'Plas'</span>,</span>
<span>  global_top_var<span class="op">=</span><span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pds</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/bootstrapped_PDs-1.png" width="768" style="display: block; margin: auto;"></p>
<p>These plots show that the presence of <em>Microfilaria</em> greatly
increases the probability of observing <em>Plasmodium</em> (from ~0.47
to 0.70 while holding all other variables at their mean value). Note
that these are marginal relationships (i.e., isolating the effect of
each predictor). When host abundance is high, the probability of
detecting <em>Plasmodium</em> decreases non-linearly (with a threshold
around ~0.5). The other parasites have less effect.</p>
<p>To explore the effect of host abundance overall, we can use the
<code><a href="../reference/mrCovar.html">mrCovar()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrCovar.html">mrCovar</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats_rf</span>,</span>
<span>  var <span class="op">=</span> <span class="st">"scale.prop.zos"</span>,</span>
<span>  sdthresh <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span></span>
<span>  <span class="va">covar</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span></span>
<span>  <span class="va">covar</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/host_abundance_effect-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Note that this isn’t bootstrapped—each line represents a taxon. The
second plot shows the community-wide average effect with taxon-specific
effects silhouetted in the background. The third plot shows the
community-wide average change in occurrence probabilities across host
abundance. <span style="color:red">Note that the occurrence
probabilities of all taxa drop at intermediate levels of host abundance
(0.75–1.25).</span></p>
</div>
<div class="section level2">
<h2 id="co-occurrence-network">Co-occurrence network<a class="anchor" aria-label="anchor" href="#co-occurrence-network"></a>
</h2>
<p>We can utilize all the bootstrapped partial dependence estimates
(PDs) to construct a co-occurrence network. The following code converts
the object to an <code>igraph</code> object and plots it. This is a
directed network, and edges are scaled by the standard deviation of the
marginal change in prediction (along the PD curves). Red edges are
positive associations (i.e., predicted occurrence increases with the
presence of the other taxon), and blue edges are negative.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assoc_net</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrCoOccurNet.html">mrCoOccurNet</a></span><span class="op">(</span><span class="va">bs_malaria</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Based on simulations (not shown here), we use </span></span>
<span><span class="co"># the following rule of thumb for associations:</span></span>
<span><span class="co"># Any association &gt; 0.05 for mean strength is </span></span>
<span><span class="co"># included</span></span>
<span><span class="va">assoc_net_filtered</span> <span class="op">&lt;-</span>  <span class="va">assoc_net</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mean_strength</span> <span class="op">&gt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert mrIML to igraph</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">graph_from_data_frame</a></span><span class="op">(</span></span>
<span>  <span class="va">assoc_net_filtered</span>,</span>
<span>  directed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  vertices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">assoc_net_filtered</span><span class="op">$</span><span class="va">mean_strength</span></span>
<span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">Color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="va">assoc_net_filtered</span><span class="op">$</span><span class="va">direction</span> <span class="op">==</span> <span class="st">"negative"</span>,</span>
<span>  <span class="st">"blue"</span>,</span>
<span>  <span class="st">"red"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the igraph to a ggplot with NMDS layout</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggnetwork/man/ggnetwork.html" class="external-link">ggnetwork</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the graph</span></span>
<span><span class="va">gg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>      xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_edges.html" class="external-link">geom_edges</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Color</span>, linewidth <span class="op">=</span> <span class="va">Value</span><span class="op">)</span>, </span>
<span>    curvature <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span></span>
<span>      length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"pt"</span><span class="op">)</span>,</span>
<span>      type <span class="op">=</span> <span class="st">"closed"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_nodes.html" class="external-link">geom_nodes</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="st">"gray"</span>, </span>
<span>    size <span class="op">=</span> <span class="fu"><a href="https://r.igraph.org/reference/degree.html" class="external-link">degree</a></span><span class="op">(</span><span class="va">g</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html" class="external-link">scale_color_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggnetwork/man/geom_nodetext_repel.html" class="external-link">geom_nodelabel_repel</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,</span>
<span>    box.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">gg</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    segment.colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"grey36"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/network_plot-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="one-way-two-way-and-three-way-interactions">One-way, two-way, and three-way interactions<a class="anchor" aria-label="anchor" href="#one-way-two-way-and-three-way-interactions"></a>
</h2>
<p>Finally, we can quantify the overall importance of interactions in
different taxa models, as well as the importance of one- and two-way
interactions for a specific taxon using the same bootstrapping approach.
To quantify interaction importance, we use H-statistics from the <a href="https://github.com/mayer79/hstats" class="external-link"><code>hstats</code></a>
package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int_</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrInteractions.html">mrInteractions</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats_rf</span>,</span>
<span>  num_bootstrap <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  feature <span class="op">=</span> <span class="st">"Plas"</span>,</span>
<span>  top_int <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">int_</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="co"># overall plot</span></span>
<span><span class="va">int_</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="co"># individual plot for feature</span></span>
<span><span class="va">int_</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>   <span class="co"># two way plot for feature</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/interactions-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The first plot shows that interactions account for an average of 60%
(with a 90% bootstrap uncertainty interval of 44–81%) of variation in
predictions for <em>H.killangoi</em>, and less for the other taxa. The
second plot shows that interactions involving host abundance most affect
predictions of <em>Plasmodium</em> (although <em>H.zosteropis</em> is
also important and, according to the uncertainty intervals, could be
even more important). This trend is similar community-wide. The last
plot shows that the interaction between <em>Haemoproteus</em> presence
and host abundance is the most important two-way interaction for
<em>Plasmodium</em>, but this isn’t true community-wide, as host
abundance and <em>H.zosteropis</em> form the strongest interaction
overall. Taken together, we can see that interactions between taxa are
mediated by host abundance.</p>
<p>Finally, we can explore specific interactions in more detail using 2D
partial dependence plots implemented in the <a href="https://mayer79.github.io/flashlight/" class="external-link"><code>flashlight</code></a>
package. Below, we plot how the two-way interaction between host
abundance and <em>H.zosteropis</em> impacts the probability of detecting
<em>Plasmodium</em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrFlashlight.html">mrFlashlight</a></span><span class="op">(</span></span>
<span>  <span class="va">yhats_rf_downSamp</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>  index <span class="op">=</span> <span class="fl">4</span> <span class="co">#index=4 selects Plas</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flashlight/man/light_profile2d.html" class="external-link">light_profile2d</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scale.prop.zos"</span>, <span class="st">"Hzosteropis"</span><span class="op">)</span>,</span>
<span>    <span class="va">data</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Graphical%20network%20model%20(GNM)_files/figure-html/two_way_int-1.png" width="768" style="display: block; margin: auto;"></p>
<p>So, if <em>H.zosteropsis</em> is not present and the relative
abundance of <em>Zosterops</em> species is low, the probability of
observing <em>Plasmodium</em> is high (&gt;0.7).</p>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>Cook et al., 2021: <a href="https://doi.org/10.18651/RWP2021-12" class="external-link uri">https://doi.org/10.18651/RWP2021-12</a> Kuhn (2014): <a href="https://doi.org/10.48550/arXiv.1405.6974" class="external-link uri">https://doi.org/10.48550/arXiv.1405.6974</a> Fountain-Jones
et al(2021): <a href="https://doi.org/10.1111/1755-0998.13495" class="external-link uri">https://doi.org/10.1111/1755-0998.13495</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://discover.utas.edu.au/Nick.FountainJones" class="external-link">Nick Fountain-Jones</a>, Ryan Leadbetter, <a href="https://machado-lab.github.io/" class="external-link">Gustavo Machado</a>, Chris Kozakiewicz, Nick Clark.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
